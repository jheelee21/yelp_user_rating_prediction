```{r}
library(readr)
library(tidyverse)
library(dplyr)
library(MASS)
# install.packages("car")
library(car)
```

```{r}
# Data Loader
data <- read.csv("yelp_data.csv")
data <- data[complete.cases(data), ]
```

```{r}
check_normality <- function(model, response) {
  par(mfrow = c(1, 3))
  # Residuals versus fitted values
  plot(x = fitted(model), y = resid(model), main = "Residual vs Fitted",
       xlab = "Fitted", ylab = "Residuals")

  # Normal Quantile-Quantile (QQ) plot
  qqnorm(resid(model))
  qqline(resid(model))

  # Histogram of response variable
  hist(response, xlab = "Response", main = "Histogram of Response Variable")
}
```

```{r}
predictors = c("fans", "compliments", "total_useful", "extreme_ratings_ratio", "elite")
```

```{r, fig.width = 15, fig.height = 5}
og_model <- lm(average_word_count ~ 
                 fans +
                 compliments + 
                 total_useful + 
                 extreme_ratings_ratio +
                 elite, 
               data = data)

check_normality(og_model, data$average_word_count)
```

```{r, fig.width = 8, fig.height = 6}
# Histogram of predictors
par(mfrow = c(2, 2))
hist(data$total_useful, xlab = "Total Number of Useful Votes ", xlim = c(0, 100), breaks = 500,
     main = "Histogram of Total Number of Useful Votes")
hist(data$extreme_ratings_ratio, xlab = "Extreme Ratings Ratio", breaks = 15,
     main = "Histogram of Extreme Ratings Ratio")
hist(data$fans, xlab = "Number of Fans", xlim = c(0, 100), breaks = 1000,
     main = "Histogram of Number of Fans")
hist(data$compliments, xlab = "Number of Compliments", xlim = c(0, 500), breaks = 1000,
     main = "Histogram of Number of Compliments")
```


```{r, fig.width = 8, fig.height = 8}
# Response versus fitted values
plot(data$average_word_count ~ fitted(og_model), ylab = "Average word count",
     main = "Response versus Fitted Values")
```

```{r, fig.width = 10, fig.height = 8}
# Pair-wise scatter plots
df <- data[predictors]
pairs(df, main = "Pair-wise Scatter Plots for Predictors")
```

```{r, fig.width = 10, fig.height = 6}
# Residuals versus each predictor 
r <- resid(og_model)
par(mfrow = c(2, 3))
plot(x = data$extreme_ratings, y = r, main = "Residual versus Extreme Ratings Ratio",
       xlab = "Extreme Ratings Ratio", ylab = "Residuals")
plot(x = data$fans, y = r, main = "Residual versus Number of Fans",
       xlab = "Number of Fans", ylab = "Residuals")
plot(x = data$total_useful, y = r, main = "Residual versus Total Number of Useful Votes",
       xlab = "Total Number of Useful Votes", ylab = "Residuals")
boxplot(r ~ data$elite, main = "Residual versus Elite",
       ylab = "Residuals", names=c("Never Been Elite", "Has been Elite"))
plot(x = data$compliments, y = r, main = "Residual versus Number of Compliments",
       xlab = "Number of Compliments", ylab = "Residuals")
```
